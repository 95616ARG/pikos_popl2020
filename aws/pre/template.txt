#!/bin/bash

export LD_PRELOAD="/usr/local/lib/libtcmalloc.so"
export PYTHONPATH="/home/ubuntu:$PYTHONPATH"
export LD_LIBRARY_PATH="$LD_LIBRARY_PATH:/usr/local/lib"

cd /home/ubuntu

WHICH_SET=@
WHAT_XML=&

BUCKETNAME1=s3://ikos
BUCKETNAME2=s3://results-ikos

# Download the input from S3
aws s3 cp $BUCKETNAME1/xml/set$WHICH_SET.txt aws.set
aws s3 cp $BUCKETNAME1/xml/exp$WHAT_XML.xml bench.xml

# Run benchexec
benchexec --no-container bench.xml

# Copy the results
RESULT=exp$WHAT_XML-set$WHICH_SET
mkdir tmp
mv results tmp/$RESULT
aws s3 cp --recursive tmp $BUCKETNAME2

poweroff
